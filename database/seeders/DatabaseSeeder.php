<?php

namespace Database\Seeders;

use App\Models\Answer;
use App\Models\Attendance;
use App\Models\Course;
use App\Models\Lecture;
use App\Models\LectureCompletion;
use App\Models\LectureSummary;
use App\Models\Question;
use App\Models\Quiz;
use App\Models\Submission;
use App\Models\User;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Schema;

class DatabaseSeeder extends Seeder
{
    use WithoutModelEvents;

    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        // Reset content tables so we reseed a clean course/lecture/quiz/question graph.
        Schema::disableForeignKeyConstraints();
        Answer::truncate();
        Question::truncate();
        Quiz::truncate();
        Lecture::truncate();
        LectureCompletion::truncate();
        LectureSummary::truncate();
        Course::truncate();
        Submission::truncate();
        Attendance::truncate();
        Schema::enableForeignKeyConstraints();

        // Keep or create a single instructor to own the seeded course (force name/email to desired values).
        $instructor = User::updateOrCreate(
            ['email' => 'instructor@example.com'],
            [
                'name' => 'شيخ حاتم',
                'role' => User::ROLE_INSTRUCTOR,
                'password' => bcrypt('password'),
            ],
        );

        $qasasInstructor = User::updateOrCreate(
            ['email' => 'engineer.basil@example.com'],
            [
                'name' => 'بشمهندس باسل مؤنس – رحمه الله',
                'role' => User::ROLE_INSTRUCTOR,
                'password' => bcrypt('password'),
            ],
        );

        // Ensure a student account exists for login/testing.
        User::where('email', 'student@example.com')->first()
            ?? User::factory()->create([
                'name' => 'طالب تجريبي',
                'email' => 'student@example.com',
                'role' => User::ROLE_STUDENT,
                'password' => bcrypt('password'),
            ]);

        // Seed the primary course with instructor ownership.
        $course = Course::create([
            'title' => 'ما لا يسع المسلم جهله',
            'description' => 'دورة علمية تهدف إلى بيان أهم الأمور التي لا يجوز للمسلم جهلها من العقيدة والعبادة والمعاملات، بأسلوب مبسط ومناسب لعامة المسلمين.',
            'instructor_id' => $instructor->id,
        ]);

        $lecturesData = [
            [
                'title' => 'معنى الإسلام والإيمان',
                'description' => 'تعريف الإسلام والإيمان وبيان العلاقة بينهما وأثرهما في حياة المسلم.',
                'questions' => [
                    ['body' => 'ما المعنى اللغوي للإسلام؟', 'answers' => ['الاستسلام والانقياد لله', 'الجدال والخصومة', 'الانصراف عن الطاعة', 'اتباع العادات']],
                    ['body' => 'ما الركن الأول للدخول في الإسلام؟', 'answers' => ['الشهادة بالتوحيد والنبوة', 'الإكثار من النوافل', 'حفظ القرآن كاملًا', 'العمل بلا نية']],
                    ['body' => 'ما علاقة الإيمان بالعمل؟', 'answers' => ['الإيمان قول وعمل يزيد وينقص', 'الإيمان قول فقط', 'الإيمان عمل فقط', 'الإيمان بلا أثر']],
                    ['body' => 'ما أثر التوحيد في حياة المسلم؟', 'answers' => ['تحرير القلب من الشرك', 'زيادة الخوف من الناس', 'الانشغال بالدنيا فقط', 'ترك الطاعات']],
                    ['body' => 'ما الفرق بين الإسلام والإيمان عند الاقتران؟', 'answers' => ['الإسلام للأعمال الظاهرة والإيمان للباطنة', 'كلاهما بمعنى واحد دائمًا', 'الإيمان للأعمال الظاهرة والإسلام للباطنة', 'لا فرق بينهما']],
                    ['body' => 'ما أعظم ما يرسخه التوحيد؟', 'answers' => ['إفراد الله بالعبادة', 'الاعتماد على المخلوق', 'الخوف من البشر', 'اتباع الهوى']],
                    ['body' => 'ما معنى الإحسان في الحديث؟', 'answers' => ['أن تعبد الله كأنك تراه', 'الإكثار من الأموال', 'الظهور أمام الناس', 'ترك العمل بالسر']],
                    ['body' => 'ما أول واجب على المكلف؟', 'answers' => ['معرفة الله وتوحيده', 'إتقان التجارة', 'السفر لطلب الدنيا', 'الجدال في العقيدة']],
                    ['body' => 'ما أعظم الذنوب؟', 'answers' => ['الشرك بالله', 'ترك المستحب', 'نسيان بعض الذكر', 'التأخر عن النوم مبكرًا']],
                    ['body' => 'ما علاقة الإيمان بالخشية؟', 'answers' => ['كلما زاد الإيمان زادت الخشية', 'لا علاقة بينهما', 'الخشية تنقص الإيمان', 'الإيمان يمنع الخشية']],
                ],
            ],
            [
                'title' => 'أركان الإسلام',
                'description' => 'عرض الأركان الخمسة وبيان أهميتها وترتيبها.',
                'questions' => [
                    ['body' => 'كم عدد أركان الإسلام؟', 'answers' => ['خمسة', 'ثلاثة', 'سبعة', 'عشرة']],
                    ['body' => 'ما الركن الأول من أركان الإسلام؟', 'answers' => ['الشهادتان', 'الصلاة', 'الزكاة', 'الصوم']],
                    ['body' => 'ما حكم الصلاة في الإسلام؟', 'answers' => ['فرض عين على المسلم البالغ', 'مستحبة فقط', 'خاصة بالعلماء', 'سنة مؤكدة لا غير']],
                    ['body' => 'ما الحكمة من الزكاة؟', 'answers' => ['تطهير المال ونشر التكافل', 'تقليل المال', 'زيادة الترف', 'إهمال الفقراء']],
                    ['body' => 'صيام رمضان ركن لمن؟', 'answers' => ['كل مسلم بالغ قادر', 'الصغار فقط', 'المسافر دائمًا', 'غير المستطيع']],
                    ['body' => 'ما شرط وجوب الحج؟', 'answers' => ['الاستطاعة', 'البلوغ فقط', 'الثراء المطلق', 'الحفظ']],
                    ['body' => 'الشهادة تعني؟', 'answers' => ['الإقرار بالتوحيد والرسالة', 'الإقرار بالمال', 'الإقرار بالعادات', 'الإقرار بالقبيلة']],
                    ['body' => 'من ترك ركنًا من الأركان جحودًا؟', 'answers' => ['يكفر لإنكاره المعلوم من الدين', 'لا حرج عليه', 'ينقص ماله فقط', 'يُعذر دائمًا']],
                    ['body' => 'الصلاة عماد؟', 'answers' => ['الدين', 'المال', 'الجاه', 'الصحة']],
                    ['body' => 'من مقاصد الحج؟', 'answers' => ['تجديد التوحيد ووحدة الأمة', 'الترفيه فقط', 'التجارة فقط', 'السياحة العادية']],
                ],
            ],
            [
                'title' => 'أركان الإيمان',
                'description' => 'شرح الأركان الستة وتعزيز اليقين بالقدر والرسل والكتب.',
                'questions' => [
                    ['body' => 'كم عدد أركان الإيمان؟', 'answers' => ['ستة', 'خمسة', 'سبعة', 'أربعة']],
                    ['body' => 'الإيمان بالملائكة يعني؟', 'answers' => ['تصديق وجودهم ووظائفهم', 'اعتبارهم رموزًا فقط', 'الشك فيهم', 'إنكارهم']],
                    ['body' => 'الإيمان بالقدر يشمل؟', 'answers' => ['الإيمان بالعلم والكتابة والمشيئة والخلق', 'الإيمان بالمشيئة فقط', 'الإيمان بالعلم فقط', 'إنكار التقدير']],
                    ['body' => 'من أركان الإيمان؟', 'answers' => ['الإيمان بالرسل', 'الإيمان بالأولياء فقط', 'الإيمان بالأعمال فقط', 'الإيمان بالأحلام']],
                    ['body' => 'الإيمان بالكتب يعني؟', 'answers' => ['تصديق الكتب المنزلة وختمها بالقرآن', 'العمل بالكتب المحرفة', 'ترك القرآن', 'الاعتماد على الرؤى']],
                    ['body' => 'الإيمان باليوم الآخر يثمر؟', 'answers' => ['محاسبة النفس والاستعداد', 'الغفلة عن الآخرة', 'ترك العمل', 'التمادي في المعاصي']],
                    ['body' => 'الإيمان بالله يتضمن؟', 'answers' => ['الإيمان بربوبيته وألوهيته وأسمائه وصفاته', 'الإيمان بالربوبية فقط', 'الإيمان بالألوهية فقط', 'إنكار الصفات']],
                    ['body' => 'الإيمان بالرسل يستلزم؟', 'answers' => ['اتباعهم فيما جاءوا به', 'مجرد التصديق دون اتباع', 'الإعراض عن سنتهم', 'اختيار ما يوافق الهوى']],
                    ['body' => 'الرضا بالقدر يعني؟', 'answers' => ['اطمئنان القلب لقضاء الله', 'ترك الأخذ بالأسباب', 'الغضب من القضاء', 'الاعتراض على الحكم']],
                    ['body' => 'الإيمان باليوم الآخر يرسخ خلق؟', 'answers' => ['المراقبة والخشية', 'الكِبر', 'الغش', 'الظلم']],
                ],
            ],
            [
                'title' => 'الطهارة وأحكامها',
                'description' => 'أحكام الوضوء والغسل والتيمم وأهميته للطهارة الحسية والمعنوية.',
                'questions' => [
                    ['body' => 'ما حكم الطهارة للصلاة؟', 'answers' => ['شرط لصحة الصلاة', 'مستحبة فقط', 'غير لازمة', 'خاصة بالجمعة']],
                    ['body' => 'عدد فروض الوضوء؟', 'answers' => ['ستة عند الجمهور', 'اثنان', 'أربعة', 'عشرة']],
                    ['body' => 'متى يشرع التيمم؟', 'answers' => ['عند فقد الماء أو تعذر استعماله', 'للكسل', 'مع وجود الماء بلا عذر', 'وقت المطر']],
                    ['body' => 'ما الذي ينقض الوضوء؟', 'answers' => ['الخارج من السبيلين', 'المشي', 'الأكل', 'النوم جالسًا ممسكًا النفس']],
                    ['body' => 'ما حكم الغسل من الجنابة؟', 'answers' => ['واجب', 'مستحب', 'مكروه', 'غير مشروع']],
                    ['body' => 'مسح الخفين يشرع؟', 'answers' => ['للمقيم يوم وليلة', 'لغير المتوضئ', 'بعد الغسل مباشرة', 'لمن لم يلبس الخف']],
                    ['body' => 'نية الوضوء محلها؟', 'answers' => ['القلب', 'اللسان فقط', 'اليدين', 'لا حاجة لها']],
                    ['body' => 'السنّة في ترتيب الوضوء؟', 'answers' => ['اتباع الترتيب الوارد', 'التقديم والتأخير بلا ترتيب', 'ترك المضمضة دائمًا', 'الاقتصار على عضو واحد']],
                    ['body' => 'الطهارة المعنوية تعني؟', 'answers' => ['طهارة القلب من الشرك والذنوب', 'الغسل فقط', 'تغيير الثياب', 'وضع الطيب']],
                    ['body' => 'إذا فقد الماء والصعيد؟', 'answers' => ['يصلي على حاله ولا يعيد', 'يترك الصلاة', 'يؤخر الصلاة بلا عذر', 'يترك الوضوء فقط']],
                ],
            ],
            [
                'title' => 'الصلاة وشروطها',
                'description' => 'بيان شروط الصلاة وأركانها وواجباتها والخشوع فيها.',
                'questions' => [
                    ['body' => 'من شروط صحة الصلاة؟', 'answers' => ['الطهارة واستقبال القبلة', 'ترك الطهارة', 'الغفلة التامة', 'ترك النية']],
                    ['body' => 'كم صلاة مفروضة في اليوم؟', 'answers' => ['خمس', 'ثلاث', 'سبع', 'عشر']],
                    ['body' => 'ما حكم ترك الصلاة عمدًا؟', 'answers' => ['إثم عظيم وخطر الكفر', 'مكروه فقط', 'مباح', 'مستحب']],
                    ['body' => 'الخشوع في الصلاة هو؟', 'answers' => ['حضور القلب وتعظيم الله', 'التفكير في الدنيا', 'رفع الصوت بلا تدبر', 'النوم']],
                    ['body' => 'ركن من أركان الصلاة؟', 'answers' => ['الركوع', 'الالتفات الكثير', 'الكلام الدنيوي', 'ترك الطمأنينة']],
                    ['body' => 'واجب من واجبات الصلاة؟', 'answers' => ['التشهد الأول', 'زيادة ركعة عمدًا', 'ترك الفاتحة', 'الضحك']],
                    ['body' => 'ما يبطل الصلاة؟', 'answers' => ['الكلام العمد لغير مصلحة', 'الذكر', 'الطمأنينة', 'الخشوع']],
                    ['body' => 'حكم الصلاة في وقتها؟', 'answers' => ['واجبة ولا تؤخر بلا عذر', 'مباح تأخيرها دائمًا', 'أفضلية فقط', 'لا أهمية لها']],
                    ['body' => 'من شروط الستر في الصلاة؟', 'answers' => ['ستر العورة', 'ترك الستر', 'كشف الرأس فقط', 'لباس ضيق شفاف']],
                    ['body' => 'قراءة الفاتحة في كل ركعة؟', 'answers' => ['ركن للمصلي المنفرد والإمام', 'مستحب فقط', 'خاص بالإمام', 'لا تشرع']],
                ],
            ],
            [
                'title' => 'الزكاة والصيام',
                'description' => 'أحكام الزكاة وشروطها ومقاديرها، وأساسيات صيام رمضان.',
                'questions' => [
                    ['body' => 'من شروط وجوب الزكاة؟', 'answers' => ['بلوغ النصاب وحولان الحول', 'أي مال قليل', 'الحصول على راتب', 'الإنفاق فقط']],
                    ['body' => 'نصاب الذهب يعادل؟', 'answers' => ['85 جرامًا تقريبًا', '10 جرامات', '200 جرام', '1 جرام']],
                    ['body' => 'مصارف الزكاة حددها؟', 'answers' => ['القرآن الكريم', 'العرف', 'القانون المدني', 'اختيار المزكي']],
                    ['body' => 'حكم صيام رمضان؟', 'answers' => ['فرض على القادر البالغ', 'مستحب', 'خاص بالعلماء', 'للمرضى فقط']],
                    ['body' => 'من أعذار الفطر؟', 'answers' => ['المرض والسفر', 'الكسل', 'العمل', 'التنزه']],
                    ['body' => 'من أفطر لعذر؟', 'answers' => ['يقضي بعد زوال العذر', 'لا يقضي', 'يدفع صدقة فقط', 'يترك الصلاة']],
                    ['body' => 'زكاة الفطر تُخرج؟', 'answers' => ['طعامًا قبل صلاة العيد', 'مالًا بعد العيد', 'ثيابًا قديمة', 'لا تشرع']],
                    ['body' => 'من مقاصد الزكاة؟', 'answers' => ['تحقيق التكافل وتزكية النفس', 'إفقار الناس', 'تقليل المال', 'التفاخر']],
                    ['body' => 'الصيام الحقيقي يشمل؟', 'answers' => ['صوم الجوارح عن المعاصي', 'ترك الطعام فقط', 'النوم طوال اليوم', 'الكذب']],
                    ['body' => 'حكم تعجيل زكاة المال؟', 'answers' => ['جائز للحاجة', 'محرم', 'واجب دائمًا', 'لا يصح']],
                ],
            ],
            [
                'title' => 'الحج والعمرة',
                'description' => 'أهم أحكام الحج والعمرة وشروطهما ومواقيتهما.',
                'questions' => [
                    ['body' => 'الحج فرض على من؟', 'answers' => ['المستطيع مرة في العمر', 'غير المستطيع', 'الصغير', 'المجنون']],
                    ['body' => 'الإحرام يبدأ من؟', 'answers' => ['الميقات المحدد', 'أي مكان', 'بعد الطواف', 'في المنزل فقط']],
                    ['body' => 'ركن من أركان الحج؟', 'answers' => ['الوقوف بعرفة', 'رمي الجمرات', 'المبيت بمنى', 'الحلق']],
                    ['body' => 'طواف الإفاضة حكمه؟', 'answers' => ['ركن لا يتم الحج إلا به', 'مستحب', 'سنة', 'غير لازم']],
                    ['body' => 'التحلل الأكبر يحصل؟', 'answers' => ['بعد رمي جمرة العقبة والحلق وطواف الإفاضة', 'بعد لبس الإحرام', 'بعد المبيت', 'بعد السعي فقط']],
                    ['body' => 'شروط وجوب العمرة؟', 'answers' => ['كالاستطاعة في الحج', 'لا شروط', 'الغنى الكبير', 'حفظ القرآن']],
                    ['body' => 'السعي بين الصفا والمروة؟', 'answers' => ['ركن في الحج والعمرة', 'سنة فقط', 'لا يشرع', 'خاص بالعمرة فقط']],
                    ['body' => 'الميقات الزماني للحج؟', 'answers' => ['أشهر الحج', 'رجب فقط', 'شعبان فقط', 'رمضان فقط']],
                    ['body' => 'نية النسك تكون؟', 'answers' => ['عند الإحرام', 'بعد الطواف', 'عند الرمي', 'عند الحلق']],
                    ['body' => 'من ترك الوقوف بعرفة؟', 'answers' => ['فاته الحج', 'يتم الحج بلا عرفة', 'لا يؤثر', 'يعوض بالصدقة']],
                ],
            ],
            [
                'title' => 'المعاملات والأخلاق',
                'description' => 'أسس المعاملات الشرعية ومكارم الأخلاق في البيع والشراء والسلوك.',
                'questions' => [
                    ['body' => 'أصل المعاملات في الشرع؟', 'answers' => ['الإباحة ما لم يرد منع', 'التحريم المطلق', 'الوجوب', 'الكراهة']],
                    ['body' => 'من صور الغرر المحرم؟', 'answers' => ['بيع ما لا يملك', 'البيع الواضح', 'البيع المعلوم', 'البيع بالكاش']],
                    ['body' => 'خلق المسلم في البيع؟', 'answers' => ['الصدق والبيان', 'الكذب والستر', 'الغش', 'الظلم']],
                    ['body' => 'حكم الربا؟', 'answers' => ['محرم وكبير', 'مكروه', 'مباح', 'مستحب']],
                    ['body' => 'الوفاء بالعقود يعني؟', 'answers' => ['الالتزام بالشروط المباحة', 'ترك الشروط', 'نقض العهد', 'الظلم']],
                    ['body' => 'الإحسان في المعاملة يثمر؟', 'answers' => ['محبة الناس وبركة المال', 'نقص المال', 'بغض الناس', 'إبطال البيع']],
                    ['body' => 'من مكارم الأخلاق؟', 'answers' => ['الصدق والأمانة', 'الخيانة', 'الكبر', 'البخل']],
                    ['body' => 'البيع بعد أذان الجمعة لمن تلزمه؟', 'answers' => ['محرم حتى الصلاة', 'مباح', 'مستحب', 'لا حكم']],
                    ['body' => 'من صور الظلم المالي؟', 'answers' => ['أكل مال اليتيم', 'إرجاع الدين', 'الإنفاق في الطاعة', 'إعطاء الحقوق']],
                    ['body' => 'الرحمة بالخلق سبب؟', 'answers' => ['رحمة الله بالعبد', 'نقص الرزق', 'الغفلة', 'القطيعة']],
                ],
            ],
            [
                'title' => 'الحلال والحرام',
                'description' => 'قواعد الحلال والحرام وبيان الضوابط في المأكل والملبس والكسب.',
                'questions' => [
                    ['body' => 'الأصل في الأشياء؟', 'answers' => ['الإباحة حتى يرد الدليل', 'التحريم مطلقًا', 'الوجوب', 'الكراهة']],
                    ['body' => 'من المحرمات في المطعومات؟', 'answers' => ['الميتة والدم ولحم الخنزير', 'الطعام الطيب', 'الخبز', 'التمر']],
                    ['body' => 'الكسب الحرام أثره؟', 'answers' => ['يمحق البركة ويمنع إجابة الدعاء', 'يزيد البركة', 'لا أثر له', 'يقوي الإيمان']],
                    ['body' => 'لبس الذهب للرجال؟', 'answers' => ['محرم', 'مكروه', 'مباح', 'مستحب']],
                    ['body' => 'التعامل بالربا حكمه؟', 'answers' => ['محرم شديد', 'مكروه', 'مباح', 'لا بأس به']],
                    ['body' => 'الغش في البيع؟', 'answers' => ['محرم وخيانة', 'مباح للمصلحة', 'مستحب', 'لا حكم له']],
                    ['body' => 'الخمر حكمها؟', 'answers' => ['حرام نجس', 'مكروه', 'مباح', 'طاهر حلال']],
                    ['body' => 'الأموال العامة حكم الاعتداء عليها؟', 'answers' => ['حرام وخيانة', 'مباح', 'واجب', 'مكروه']],
                    ['body' => 'متى يكون الحلال حلالًا؟', 'answers' => ['مع طيب الكسب وترك الحرام', 'مع الظلم', 'مع الربا', 'مع الغصب']],
                    ['body' => 'من قواعد الحلال والحرام؟', 'answers' => ['الضرورات تبيح المحظورات بقدرها', 'الضرورات تبيح كل شيء بلا حد', 'لا ضرورة معتبرة', 'المحرم دائمًا مباح']],
                ],
            ],
            [
                'title' => 'حقوق الله وحقوق العباد',
                'description' => 'التفريق بين حقوق الله وحقوق الخلق وأهمية أدائها وعدم التفريط فيها.',
                'questions' => [
                    ['body' => 'أعظم حقوق الله على عباده؟', 'answers' => ['أن يعبدوه ولا يشركوا به شيئًا', 'الانشغال بالدنيا', 'ترك الطاعة', 'اتباع الشهوات']],
                    ['body' => 'من حقوق العباد المالية؟', 'answers' => ['رد المظالم والديون', 'الاعتداء على الأموال', 'أكل الربا', 'الغش']],
                    ['body' => 'حقوق الوالدين تشمل؟', 'answers' => ['البر والإحسان والطاعة في غير معصية', 'العقوق', 'الهجر', 'الاستهزاء']],
                    ['body' => 'حق الجار؟', 'answers' => ['كف الأذى وبذل الخير', 'الإيذاء', 'الغش', 'السخرية']],
                    ['body' => 'من حقوق الزوجة؟', 'answers' => ['النفقة والسكنى والمعاملة بالمعروف', 'الظلم', 'المنع من الحقوق', 'الإهمال']],
                    ['body' => 'من حقوق الزوج؟', 'answers' => ['الطاعة في المعروف وصيانة البيت', 'العصيان', 'الإيذاء', 'الإهمال']],
                    ['body' => 'التعدي على دم المسلم حكمه؟', 'answers' => ['حرام عظيم', 'مباح', 'مكروه', 'سنة']],
                    ['body' => 'الغيبة والنميمة حكمهما؟', 'answers' => ['حرامان يفسدان الحقوق', 'مباح', 'واجب', 'مستحب']],
                    ['body' => 'أداء الحقوق يوم القيامة يكون؟', 'answers' => ['بالحسنات والسيئات', 'بالمال فقط', 'لا حساب', 'بالأنساب']],
                    ['body' => 'من وسائل حفظ الحقوق؟', 'answers' => ['العدل والتقوى والمراقبة', 'الظلم', 'الخيانة', 'الكذب']],
                ],
            ],
        ];

        foreach ($lecturesData as $index => $lectureData) {
            $lecture = $course->lectures()->create([
                'title' => $lectureData['title'],
                'description' => $lectureData['description'],
                'position' => $index + 1,
                'video_url' => null,
                'audio_url' => 'https://www.example.com',
            ]);

            // One quiz per lecture; tie back to the course via course_id.
            $quiz = $lecture->quiz()->create([
                'course_id' => $course->id,
                'title' => 'اختبار المحاضرة ' . ($index + 1),
                'description' => $lectureData['description'],
            ]);

            foreach ($lectureData['questions'] as $qIndex => $questionData) {
                $question = $quiz->questions()->create([
                    'body' => $questionData['body'],
                    'type' => 'mcq',
                    'points' => 1,
                    'position' => $qIndex + 1,
                ]);

                foreach ($questionData['answers'] as $aIndex => $answerText) {
                    $question->answers()->create([
                        'body' => $answerText,
                        'is_correct' => $aIndex === 0,
                        'position' => $aIndex,
                    ]);
                }
            }
        }

        // Seed new course: تدبر سورة القصص
        $qasasCourse = Course::create([
            'title' => 'تدبر سورة القصص',
            'description' => 'دورة تدبر لسورة القصص مع الوقوف على العبر العملية في حياة موسى عليه السلام وقومه.',
            'instructor_id' => $qasasInstructor->id,
        ]);

        $qasasLectures = [
            [
                'title' => 'تمهيد حول سورة القصص',
                'description' => 'مقاصد السورة وبنية القصص الرئيسية.',
                'video_url' => 'https://youtu.be/xMwATKRljuc?si=ShuwniyR5-aGxmpd',
                'audio_url' => config('app.url') . '/Audio/qass-basel-1.mp3',
                'summary' => 'بيان أهداف سورة القصص في تثبيت قلب النبي، وبيان سنن الله في حماية دعوته ونصرة المستضعفين.',
                'questions' => [
                    ['body' => 'ما أبرز هدف لسورة القصص؟', 'answers' => ['تثبيت قلب النبي وبيان سنن الدعوة', 'عرض أحكام فقهية تفصيلية', 'ترتيب أنساب قريش', 'حصر المعاملات المالية']],
                    ['body' => 'ما محور السورة العام؟', 'answers' => ['قصة موسى مع فرعون وقومه', 'قصة يوسف عليه السلام', 'سيرة النبي صلى الله عليه وسلم كاملة', 'غزوات المدينة']],
                    ['body' => 'لماذا سميت بالقصص؟', 'answers' => ['لاحتوائها على قصص متتابعة تحمل العبرة', 'لأنها سورة مكية قصيرة', 'لأنها تخلو من القصص', 'لأنها سورة مدنية']],
                ],
            ],
            [
                'title' => 'ميلاد موسى عليه السلام',
                'description' => 'المشهد الأول من ولادة موسى وسط بطش فرعون.',
                'video_url' => 'https://youtu.be/RWGCtKqKcYI?si=HKT0mSlQu9Dfcdr3',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-02.mp3',
                'summary' => 'حفظ الله يبدأ من لحظة الميلاد رغم قرارات القتل، ووعد الله لوالدة موسى بالرد والحفظ.',
                'questions' => [
                    ['body' => 'ما تهديد فرعون لبني إسرائيل آنذاك؟', 'answers' => ['قتل الأبناء واستحياء النساء', 'الإكرام والاحتفاء', 'إطلاق الحرية لهم', 'تركهم دون مراقبة']],
                    ['body' => 'كيف طمأن الله أم موسى؟', 'answers' => ['بوعد الرد والحفظ', 'بإرسال جيش يحميها', 'بتركها بلا توجيه', 'بعدم ذكر أي وعد']],
                    ['body' => 'ما دلالة إلقاء موسى في اليم؟', 'answers' => ['الأخذ بالأسباب مع التوكل', 'ترك الأسباب تماماً', 'اليأس من النجاة', 'إهمال الوحي']],
                ],
            ],
            [
                'title' => 'النجاة من فرعون',
                'description' => 'انتقال موسى إلى بيت فرعون وتربية العناية الإلهية.',
                'video_url' => 'https://youtu.be/mAbpIG2lj-M?si=UcEFICp33azdLgUz',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-03.mp3',
                'summary' => 'عناية الله تربي موسى في بيت عدوه لتكتمل أسباب القوة والهيبة مع حفظ الإيمان.',
                'questions' => [
                    ['body' => 'أين نشأ موسى بعد الميلاد؟', 'answers' => ['في بيت فرعون', 'في بيوت بني إسرائيل', 'في مدين', 'في الصحراء بعيدًا']],
                    ['body' => 'ما المغزى من هذه النشأة؟', 'answers' => ['إعداد قيادي وسط العدو', 'إبعاده عن أي تعلم', 'إذلاله بين قومه', 'منعه من الرسالة']],
                    ['body' => 'من الذي رفضت ثديها موسى؟', 'answers' => ['المراضع جميعاً حتى رجع لأمه', 'أول مرضعة فقط', 'لم يرفض أحد', 'أخته فقط']],
                ],
            ],
            [
                'title' => 'الخروج إلى مدين',
                'description' => 'حادثة القتل غير المقصود وخروج موسى خائفاً يترقب.',
                'video_url' => 'https://youtu.be/-Lwtk33QLsw?si=5bVwQQfi9JT-96Je',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-04.mp3',
                'summary' => 'خطأ غير مقصود يقود موسى للهجرة، مع صدق التوبة والدعاء بالحفظ والهداية.',
                'questions' => [
                    ['body' => 'ما سبب خروج موسى؟', 'answers' => ['قتل غير مقصود لرجل من قوم فرعون', 'أمر إلهي مباشر بالهجرة', 'دعوة من شعيب', 'رغبة في السفر فقط']],
                    ['body' => 'كيف وصف حاله عند الخروج؟', 'answers' => ['خائف يترقب', 'مطمئن', 'غاضب جدًا', 'غير مبالٍ']],
                    ['body' => 'ما الدعاء الذي قاله؟', 'answers' => ['رب نجني من القوم الظالمين', 'رب زدني مالاً', 'رب أعدني إلى فرعون', 'رب اجعلني من المترفين']],
                ],
            ],
            [
                'title' => 'اللقاء بشعيب عليه السلام',
                'description' => 'مساعدة الفتاتين والزواج والعمل في مدين.',
                'video_url' => 'https://youtu.be/xTG8dbMZFuQ?si=LHydXdPxqNGpeDgJ',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-05.mp3',
                'summary' => 'نموذج للحياء والتكافل، وموسى يتربى على الصبر والعمل قبل الرسالة.',
                'questions' => [
                    ['body' => 'ماذا فعل موسى للفتاتين؟', 'answers' => ['سقى لهما', 'أعطاهما مالًا', 'تركهما', 'وبخهما']],
                    ['body' => 'ما أبرز صفة ظهرت في الفتاتين؟', 'answers' => ['الحياء', 'الجرأة الزائدة', 'الجدال', 'القسوة']],
                    ['body' => 'ماذا كان شرط شعيب للعمل والزواج؟', 'answers' => ['العمل ثماني حجج أو عشر', 'دفع مال كبير', 'العودة لمصر', 'ترك الدعوة']],
                ],
            ],
            [
                'title' => 'العودة بالرسالة',
                'description' => 'التكليف بالرسالة عند الوادي المقدس طوى.',
                'video_url' => 'https://youtu.be/GB_5B_74ZiM?si=uePLAXYx57FeQd43',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-06.mp3',
                'summary' => 'التكليف بالرسالة، آية العصا واليد، ودعاء موسى بتيسير المهمة.',
                'questions' => [
                    ['body' => 'أين كُلِّف موسى بالرسالة؟', 'answers' => ['الوادي المقدس طوى', 'بيت فرعون', 'مدين', 'المدينة']],
                    ['body' => 'ما أول الآيات التي أُعطيها؟', 'answers' => ['العصا واليد البيضاء', 'شطر البحر', 'الغرق', 'الطوفان']],
                    ['body' => 'ما دعاؤه قبل الذهاب لفرعون؟', 'answers' => ['رب اشرح لي صدري ويسر لي أمري', 'رب زدني مالًا', 'رب أرسل غيري', 'رب اجعلني ملكًا']],
                ],
            ],
            [
                'title' => 'مواجهة فرعون بالآيات',
                'description' => 'عرض الآيات والحوار مع فرعون وملئه.',
                'video_url' => 'https://youtu.be/ZHQkFs9tqwQ?si=qiFewv2p0XoYx8jz',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-07.mp3',
                'summary' => 'إظهار البينات، تكذيب فرعون، وصبر موسى وثقته بنصر الله.',
                'questions' => [
                    ['body' => 'كيف استقبل فرعون الآيات؟', 'answers' => ['كذّب واستكبر', 'آمن مباشرة', 'تجاهلها بلا كلام', 'فرّ هاربًا']],
                    ['body' => 'ما موقف السحرة لاحقًا؟', 'answers' => ['آمنوا بالحق لما تبين', 'ثبتوا على الكفر', 'تحالفوا مع فرعون', 'هربوا بعيدًا']],
                    ['body' => 'بمَ واجه موسى التكذيب؟', 'answers' => ['الصبر والثقة بوعد الله', 'اليأس والترك', 'العنف بلا دعوة', 'الانسحاب مبكرًا']],
                ],
            ],
            [
                'title' => 'الغرق والنجاة',
                'description' => 'مشهد الانفراج بعبور البحر وغرق فرعون.',
                'video_url' => 'https://youtu.be/yhP7NeEJsic?si=M2Lu5pvjTRKB-9Fd',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-08.mp3',
                'summary' => 'الفرج يأتي عند اليأس، وضرب البحر بالعصا سبب، والنصر من عند الله.',
                'questions' => [
                    ['body' => 'ما سبب النجاة المادي؟', 'answers' => ['ضرب البحر بالعصا بأمر الله', 'عدد الجنود الكبير', 'سلاح متطور', 'التفاوض مع فرعون']],
                    ['body' => 'ما مصير فرعون؟', 'answers' => ['الغرق مع جنوده', 'النجاة', 'القبض عليه حيًا', 'الهجرة إلى مدين']],
                    ['body' => 'ما العبرة من المشهد؟', 'answers' => ['الأخذ بالأسباب مع اليقين بنصر الله', 'ترك الأسباب تمامًا', 'اليأس عند الشدة', 'الثقة بفرعون']],
                ],
            ],
            [
                'title' => 'العبرة من قارون',
                'description' => 'قصة قارون وفتنة المال والغرور.',
                'video_url' => 'https://youtu.be/tcW2MfTmxVE?si=31yuR2vaj9BdeL7o',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-09.mp3',
                'summary' => 'فتنة المال تغوي بالكبر، والمال بدون شكر وعدل سبب للهلاك.',
                'questions' => [
                    ['body' => 'ما فتنة قارون الكبرى؟', 'answers' => ['المال والكبر', 'الفقر', 'الجهل التام', 'الخوف']],
                    ['body' => 'بمَ نصحه قومه؟', 'answers' => ['ابتغاء الآخرة وعدم الفساد', 'جمع المزيد بلا حدود', 'ترك الصدقة تمامًا', 'الهجرة فورًا']],
                    ['body' => 'ما مصيره؟', 'answers' => ['خسف الله به وبداره الأرض', 'نجا وازداد مالاً', 'صار ملكًا', 'هاجر إلى مدين']],
                ],
            ],
            [
                'title' => 'سنن الله في الأمم',
                'description' => 'إظهار قوانين الهداية والضلال في مسيرة الأمم.',
                'video_url' => 'https://youtu.be/lqDC4Oxt3eQ?si=o6MYUWB7ouWPt0gb',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-10.mp3',
                'summary' => 'سنن ثابتة: تداول الأيام، رفع المستضعفين، هلاك المستكبرين عند الإصرار.',
                'questions' => [
                    ['body' => 'ما من سنن الله المذكورة؟', 'answers' => ['رفع المستضعفين إذا صبروا وآمنوا', 'تمكين الظالم دائمًا', 'انتصار الباطل مطلقًا', 'غياب السنن'],
                    ],
                    ['body' => 'كيف يُهلك الله المستكبرين؟', 'answers' => ['بعد قيام الحجة وتمادٍ في الكبر', 'عشوائيًا بلا سبب', 'بمجرد الخطر', 'لا يهلكهم أبداً']],
                    ['body' => 'ما المطلوب من المؤمن تجاه السنن؟', 'answers' => ['الأخذ بالأسباب والإيمان بالنتيجة', 'ترك العمل', 'اليأس', 'الاعتماد على المعجزات فقط']],
                ],
            ],
            [
                'title' => 'خاتمة التدبر والدروس العملية',
                'description' => 'تلخيص العبر العملية لسورة القصص.',
                'video_url' => 'https://youtu.be/DImvpGgl5dY?si=8J0WVWgOi58tu53L',
                'audio_url' => 'https://www.example.com/audio/tadabbur-qasas-11.mp3',
                'summary' => 'تجميع الدروس: التوكل مع الأخذ بالأسباب، الصبر على الطريق، الثبات على الدعوة، وزوال الكبر.',
                'questions' => [
                    ['body' => 'ما أبرز درسين ختاميين؟', 'answers' => ['التوكل مع العمل والصبر', 'ترك العمل كليًا', 'اليأس من الدعوة', 'الغلو في الكبر']],
                    ['body' => 'كيف يُحفظ الداعية؟', 'answers' => ['بالثقة بوعد الله واتخاذ الأسباب', 'بالاعتماد على نفسه فقط', 'بترك الدعوة', 'بالتكبر على الناس']],
                    ['body' => 'ماذا يحدث للكبر؟', 'answers' => ['سبب للهلاك والزوال', 'مصدر للرفعة', 'لا أثر له', 'يُمدح دائمًا']],
                ],
            ],
        ];

        foreach ($qasasLectures as $index => $lectureData) {
            $lecture = $qasasCourse->lectures()->create([
                'title' => $lectureData['title'],
                'description' => $lectureData['description'],
                'position' => $index + 1,
                'video_url' => $lectureData['video_url'],
                'audio_url' => $lectureData['audio_url'],
            ]);

            LectureSummary::create([
                'lecture_id' => $lecture->id,
                'summary' => $lectureData['summary'],
                'generated_by' => 'seeded-text',
                'generated_at' => now(),
            ]);

            $quiz = $lecture->quiz()->create([
                'course_id' => $qasasCourse->id,
                'title' => 'اختبار المحاضرة ' . ($index + 1),
                'description' => $lectureData['description'],
            ]);

            foreach ($lectureData['questions'] as $qIndex => $questionData) {
                $question = $quiz->questions()->create([
                    'body' => $questionData['body'],
                    'type' => 'mcq',
                    'points' => 1,
                    'position' => $qIndex + 1,
                ]);

                foreach ($questionData['answers'] as $aIndex => $answerText) {
                    $question->answers()->create([
                        'body' => $answerText,
                        'is_correct' => $aIndex === 0,
                        'position' => $aIndex,
                    ]);
                }
            }
        }
    }
}
